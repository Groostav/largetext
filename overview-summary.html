<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0) on Mon Mar 31 15:14:57 CEST 2014 -->
<title>Overview (largetext 0.1-SNAPSHOT API)</title>
<meta name="date" content="2014-03-31">
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script type="text/javascript" src="script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Overview (largetext 0.1-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li>Package</li>
<li>Class</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev</li>
<li>Next</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">Frames</a></li>
<li><a href="overview-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 class="title">largetext 0.1-SNAPSHOT API</h1>
</div>
<div class="header">
<div class="subTitle">
<div class="block">largetext: use regexes on large text files seamlessly</div>
</div>
<p>See: <a href="#overview.description">Description</a></p>
</div>
<div class="contentContainer">
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Packages table, listing packages, and an explanation">
<caption><span>Packages</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Package</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="com/github/fge/largetext/package-summary.html">com.github.fge.largetext</a></td>
<td class="colLast">
<div class="block">Main user interface</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="com/github/fge/largetext/load/package-summary.html">com.github.fge.largetext.load</a></td>
<td class="colLast">
<div class="block">Classes dealing with file I/O</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="com/github/fge/largetext/sequence/package-summary.html">com.github.fge.largetext.sequence</a></td>
<td class="colLast">
<div class="block">Subsequences of a <a href="com/github/fge/largetext/LargeText.html" title="class in com.github.fge.largetext"><code>LargeText</code></a></div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="contentContainer"><a name="overview.description">
<!--   -->
</a>
<div class="block"><h1>largetext: use regexes on large text files seamlessly</h1>

<h2>Why</h2>

<p>This is a toy project, really; it stemmed from a <a
href="http://stackoverflow.com/q/22017480/1093528" target="_blank">discussion
on StackOverflow</a>, where the user wanted to search for a pattern within large
text files.</p>

<p>The suggested and accepted answer (mine) was to implement <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/CharSequence.html?is-external=true" title="class or interface in java.lang"><code>CharSequence</code></a> over such a large text file, since a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html?is-external=true" title="class or interface in java.util.regex"><code>Matcher</code></a> expects a <code>CharSequence</code> as an argument.</p>

<p>And just for the heck of it, I decided to have a go at it, and this is the
result! You can now use regexes over large text files (nearly) seamlessly.</p>

<h2>Sample usage</h2>

<pre>
    // Default factory: UTF-8 character encoding, 2 MiB window size
    final LargeTextFactory factory = LargeTextFactory.defaultFactory();
    final Path fileToSearch = Paths.get("path/to/large/textfile.txt");
    final Pattern pattern = Pattern.compile(...);

    try (
        final LargeText input = factory.fromPath(fileToSearch);
    ) {
        final Matcher m = pattern.matcher(input);
        if (m.find())
            System.out.println(fileToSearch + " has a match");
    }
</pre>

<p>The first thing you need to do is create a <a href="com/github/fge/largetext/LargeTextFactory.html" title="class in com.github.fge.largetext"><code>LargeTextFactory</code></a>. You can customize two parameters for
an individual factory:</p>

<ul>
    <li>which character encoding to use when decoding the file (in Java, that is
    a <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/charset/Charset.html?is-external=true" title="class or interface in java.nio.charset"><code>Charset</code></a>);</li>
    <li>the size of individual <em>byte</em> windows to use when performing the
    decoding operation.</li>
</ul>

<p>The first option is of course essential, since Java cannot know in advance
what character encoding your file uses. The second option allows you to
customize the amount of memory used in the decoding process and during the
lifetime of the <code>LargeText</code> instance.</p>

<p>Note that due to inherent limitations of Java classes, you will not be
allowed to create windows larger than 2^31 - 1 bytes (that is,
<code>Integer.MAX_VALUE</code>); also, there is a lower limit of 1024 bytes per
window.</p>

<p>See the <a href="com/github/fge/largetext/LargeTextFactory.html" title="class in com.github.fge.largetext"><code>LargeTextFactory</code></a> documentation for
customization options.</p>

<h2>How it works internally</h2>

<h3>Foreword: the <code>CharSequence</code> interface...</h3>

<p>... Has no support for blocking operations; its contract does not account for
failures in any of its defined methods, and with this package it is a real
possibility...</p>

<p>As a result, all exceptions thrown by this package when the decoding/loading
operations fail are <em>unchecked</em>.</p>

<h3>The decoding process</h3>

<p>When you initiate a <code>LargeText</code> instance, a background thread will
perform the decoding operation, window by window; the size of this window is
determined by your <code>LargeTextFactory</code>.</p>

<p>When you call any method of a <code>CharSequence</code> on a
<code>LargeText</code> instance, the method will block until the required
number of characters have been decoded; this will be all of them for
<code>.length()</code>, the required offset for <code>.charAt()</code>,
or the upper bound for <code>.subSequence()</code>.</p>

<p>The decoding is performed using a <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/charset/CharsetDecoder.html?is-external=true" title="class or interface in java.nio.charset"><code>CharsetDecoder</code></a>.
This decoder will attempt to decode one byte window into a suitable <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/CharBuffer.html?is-external=true" title="class or interface in java.nio"><code>CharBuffer</code></a>. Each time a decoding operation completes successfully,
all threads waiting for <code>n</code> characters where <code>n</code> is less
than, or equal to, the number of successfully decoded characters at this point
will be woken up.</p>

<p>A dedicated waiter is produced for callers of the <code>.length()</code>
method, shared between all callers, which will wait for the decoding operation
to complete.</p>

<p>In the event of a failure (either because of an I/O error, or because of an
unmappable byte sequence) or an early thread interruption, an unchecked
exception is thrown. If the failure is due to a requested offset being too
large, an <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/ArrayIndexOutOfBoundsException.html?is-external=true" title="class or interface in java.lang"><code>ArrayIndexOutOfBoundsException</code></a> is thrown.</p>

<h2>Subsequence generation and text loading</h2>

<p>The output of the decoding process is a <a href="http://docs.guava-libraries.googlecode.com/git-history/v16.0.1/javadoc/com/google/common/collect/RangeMap.html?is-external=true" title="class or interface in com.google.common.collect"><code>RangeMap</code></a>, mapping character offsets to <a href="com/github/fge/largetext/load/TextRange.html" title="class in com.github.fge.largetext.load"><code>TextRange</code></a>s; using one <code>TextRange</code>,
the <a href="com/github/fge/largetext/load/TextLoader.html" title="class in com.github.fge.largetext.load"><code>TextLoader</code></a> instance attached to the
file then loads (if needed) the needed text from the file in a <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/CharBuffer.html?is-external=true" title="class or interface in java.nio"><code>CharBuffer</code></a>.</p>

<p>A <code>TextLoader</code> uses a <a href="http://docs.guava-libraries.googlecode.com/git-history/v16.0.1/javadoc/com/google/common/cache/LoadingCache.html?is-external=true" title="class or interface in com.google.common.cache"><code>LoadingCache</code></a>
with an expiry policy of 30 seconds after last access; at the moment, this is
not configurable (it will be in the future); but the net effect is that each
"text zone" in the file is shared by all instances which need it at the same
time.</p>

<p>Finally, a subsequence may cover one or more text ranges. The <a href="com/github/fge/largetext/sequence/CharSequenceFactory.html" title="class in com.github.fge.largetext.sequence"><code>CharSequenceFactory</code></a> instance will account for
this and return the minimal sequence implementation needed by the caller (either
a <a href="com/github/fge/largetext/sequence/SingleTextRangeCharSequence.html" title="class in com.github.fge.largetext.sequence"><code>SingleTextRangeCharSequence</code></a> or a
<a href="com/github/fge/largetext/sequence/MultiTextRangeCharSequence.html" title="class in com.github.fge.largetext.sequence"><code>MultiTextRangeCharSequence</code></a>).</p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li class="navBarCell1Rev">Overview</li>
<li>Package</li>
<li>Class</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="deprecated-list.html">Deprecated</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev</li>
<li>Next</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">Frames</a></li>
<li><a href="overview-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
